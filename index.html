<!-- Load face-api first -->
<script src="https://cdn.jsdelivr.net/npm/face-api.js/dist/face-api.min.js"></script>

<!-- Then run your code AFTER -->
<script>
  window.addEventListener('DOMContentLoaded', async () => {
    const video = document.getElementById('video');
    const overlay = document.getElementById('overlay');
    const ctx = overlay.getContext('2d');

    // Load models directly from CDN (no self-hosting required)
    await Promise.all([
      faceapi.nets.tinyFaceDetector.loadFromUri('https://cdn.jsdelivr.net/gh/justadudewhohacks/face-api.js@master/weights'),
      faceapi.nets.faceExpressionNet.loadFromUri('https://cdn.jsdelivr.net/gh/justadudewhohacks/face-api.js@master/weights')
    ]);

    startVideo();

    function startVideo() {
      navigator.mediaDevices.getUserMedia({ video: {} })
        .then(stream => {
          video.srcObject = stream;
        })
        .catch(err => console.error('Error accessing webcam:', err));
    }

    video.addEventListener('play', () => {
      overlay.width = video.width;
      overlay.height = video.height;

      setInterval(async () => {
        const detections = await faceapi
          .detectAllFaces(video, new faceapi.TinyFaceDetectorOptions())
          .withFaceExpressions();
        ctx.clearRect(0, 0, overlay.width, overlay.height);
        faceapi.draw.drawDetections(overlay, detections);
        faceapi.draw.drawFaceExpressions(overlay, detections);
      }, 100);
    });
  });
</script>
