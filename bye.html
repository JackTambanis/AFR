<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Chaotic Music Visualizer â€” Jack Tambanis</title>
<style>
  *{margin:0;padding:0;box-sizing:border-box;}
  body{overflow:hidden;background:#000;font-family:system-ui,sans-serif;color:#fff;}
  canvas{display:block;}
  #startText{
    position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);
    font-size:1.5rem;color:#fff;cursor:pointer;
  }
</style>
</head>
<body>
<canvas id="canvas"></canvas>
<div id="startText">Tap to start</div>
<script>
const canvas=document.getElementById("canvas");
const ctx=canvas.getContext("2d");
let w,h;
function resize(){w=canvas.width=window.innerWidth;h=canvas.height=window.innerHeight;}
window.addEventListener("resize",resize);
resize();

// Color palettes
const palettes=[
  ['#ff4f81','#00ffff','#fffd00','#ff6b00','#8cff00'],
  ['#ff0000','#00ff00','#0000ff','#ffff00','#00ffff'],
  ['#ff7f50','#7fffd4','#dda0dd','#f0e68c','#ffb6c1']
];
let currentPalette=0;

// Audio
const tracks=[
  "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3",
  "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-2.mp3"
];
let currentTrack=0;
const audio=new Audio(tracks[currentTrack]);
audio.loop=true;
audio.crossOrigin="anonymous";

const audioCtx=new (window.AudioContext||window.webkitAudioContext)();
const source=audioCtx.createMediaElementSource(audio);
const analyser=audioCtx.createAnalyser();
source.connect(analyser);
analyser.connect(audioCtx.destination);
analyser.fftSize=256;
const dataArray=new Uint8Array(analyser.frequencyBinCount);

// Particles
let particles=[];
function createParticle(x,y){
  const size=Math.random()*6+3;
  const color=palettes[currentPalette][Math.floor(Math.random()*palettes[currentPalette].length)];
  particles.push({x:x,y:y,vx:(Math.random()-0.5)*4,vy:(Math.random()-0.5)*4,size:size,color:color,life:100});
}

// Pointer
let pointer={x:w/2,y:h/2};
window.addEventListener("mousemove",e=>{pointer.x=e.clientX;pointer.y=e.clientY;});
window.addEventListener("touchmove",e=>{
  e.preventDefault();pointer.x=e.touches[0].clientX;pointer.y=e.touches[0].clientY;
},{passive:false});

// Radial wave bursts
function createWave(x,y){
  for(let i=0;i<12;i++){
    const angle=(i/12)*Math.PI*2;
    const speed=2+Math.random()*2;
    const color=palettes[currentPalette][Math.floor(Math.random()*palettes[currentPalette].length)];
    particles.push({x:x,y:y,vx:Math.cos(angle)*speed,vy:Math.sin(angle)*speed,size:Math.random()*5+3,color:color,life:60});
  }
}

// Tap to start
const startText=document.getElementById("startText");
let started=false;
startText.addEventListener("click",()=>{
  audioCtx.resume(); audio.play(); started=true;
  startText.style.display='none';
  draw();
});

// Draw loop
function draw(){
  if(!started) return;
  ctx.fillStyle='rgba(0,0,0,0.2)'; ctx.fillRect(0,0,w,h);

  analyser.getByteFrequencyData(dataArray);
  let avg=0; for(let v of dataArray) avg+=v;
  avg/=dataArray.length; let scale=avg/100;

  // Update particles
  for(let i=particles.length-1;i>=0;i--){
    let p=particles[i];
    p.x+=p.vx*scale; p.y+=p.vy*scale; p.life--; p.size*=0.97;
    ctx.beginPath(); ctx.arc(p.x,p.y,p.size,0,Math.PI*2);
    ctx.fillStyle=p.color; ctx.fill();
    if(p.life<=0||p.size<0.5) particles.splice(i,1);
  }

  // Lines
  for(let i=0;i<particles.length;i++){
    for(let j=i+1;j<particles.length;j++){
      const dx=particles[i].x-particles[j].x, dy=particles[i].y-particles[j].y;
      const dist=Math.sqrt(dx*dx+dy*dy);
      if(dist<120){ctx.strokeStyle=`hsla(${Math.random()*360},80%,60%,0.1)`;ctx.lineWidth=1;
        ctx.beginPath();ctx.moveTo(particles[i].x,particles[i].y);ctx.lineTo(particles[j].x,particles[j].y);ctx.stroke();}
    }
  }

  // Continuous particles near pointer
  createParticle(pointer.x,pointer.y);
  requestAnimationFrame(draw);
}

// Tap bursts
window.addEventListener("click",e=>createWave(e.clientX,e.clientY));
window.addEventListener("touchstart",e=>createWave(e.touches[0].clientX,e.touches[0].clientY),{passive:false});
</script>
</body>
</html>
