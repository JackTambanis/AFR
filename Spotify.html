<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Spotify Beat Visualizer</title>
<style>
body { margin:0; background:#000; color:#fff; font-family:sans-serif; display:flex; flex-direction:column; align-items:center; }
#search { margin-top:20px; width:80%; max-width:400px; padding:8px; border-radius:4px; border:none; }
#canvas { margin-top:20px; width:90%; max-width:600px; height:300px; background:#111; display:block; }
button { margin-top:10px; padding:8px 16px; border:none; border-radius:4px; background:#1DB954; color:#fff; cursor:pointer; }
iframe { margin-top:20px; border:none; }
</style>
</head>
<body>

<h1>Spotify Beat Visualizer</h1>
<input id="search" placeholder="Search Spotify Track">
<button id="loadBtn">Load Song</button>
<div id="playerContainer"></div>
<canvas id="canvas"></canvas>

<script>
const clientId = "1e46cb9ab3324c2e8ecfedf05788ccf5";
const clientSecret = "b82e1301092f400c9cd2457f11333071";

let accessToken = "";
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");
function resizeCanvas(){canvas.width = canvas.offsetWidth; canvas.height = canvas.offsetHeight;}
window.addEventListener("resize",resizeCanvas);
resizeCanvas();

// Get Spotify access token (front-end, exposes secret)
async function getToken(){
  const res = await fetch("https://accounts.spotify.com/api/token",{
    method:"POST",
    headers:{
      "Content-Type":"application/x-www-form-urlencoded",
      "Authorization":"Basic "+btoa(clientId+":"+clientSecret)
    },
    body:"grant_type=client_credentials"
  });
  const data = await res.json();
  accessToken = data.access_token;
}
await getToken();

// Load song
document.getElementById("loadBtn").addEventListener("click", async ()=>{
  const query = document.getElementById("search").value;
  const res = await fetch(`https://api.spotify.com/v1/search?q=${encodeURIComponent(query)}&type=track&limit=1`,{
    headers:{ Authorization: "Bearer "+accessToken }
  });
  const data = await res.json();
  if(!data.tracks.items.length){alert("Track not found"); return;}
  const track = data.tracks.items[0];
  document.getElementById("playerContainer").innerHTML =
    `<iframe src="https://open.spotify.com/embed/track/${track.id}" width="300" height="80" allow="encrypted-media" allowtransparency="true"></iframe>`;
});

// Simple particle animation
let particles = Array.from({length:50},()=>({x:Math.random()*canvas.width,y:Math.random()*canvas.height,size:Math.random()*4+2,speed:Math.random()*2+1}));
function animate(){
  ctx.fillStyle="rgba(0,0,0,0.1)";
  ctx.fillRect(0,0,canvas.width,canvas.height);
  particles.forEach(p=>{
    p.y-=p.speed;
    if(p.y<0)p.y=canvas.height;
    ctx.beginPath();
    ctx.arc(p.x,p.y,p.size,0,Math.PI*2);
    ctx.fillStyle='hsl('+(p.y/canvas.height*360)+',100%,50%)';
    ctx.fill();
  });
  requestAnimationFrame(animate);
}
animate();
</script>

</body>
</html>
